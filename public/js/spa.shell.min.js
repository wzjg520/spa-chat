spa.shell=(function(){var m={anchor_schema_map:{chat:{opened:true,closed:true}},resize_interval:200,main_html:String()+'<div class="spa-shell-head"><div class="spa-shell-head-logo"><h1>SPA</h1><p>javascript end to end</p></div><div class="spa-shell-head-acct"></div></div><div class="spa-shell-main"><div class="spa-shell-main-nav"></div><div class="spa-shell-main-content"></div></div><div class="spa-shell-foot"></div><div class="spa-shell-modal"></div>'},g={$container:undefined,anchor_map:{},resize_idto:undefined},i={},c,h,l,a,f,j,d,k,e,b;
c=function(){return $.extend(true,{},g.anchor_map);};h=function(){var n=g.$container;i={$container:n,$acct:n.find(".spa-shell-head-acct"),$nav:n.find(".spa-shell-main-nav")};
};l=function(s){var q=c(),o=true,r,n;KEYVAL:for(r in s){if(s.hasOwnProperty(r)){if(r.indexOf("_")===0){continue KEYVAL;}q[r]=s[r];n="_"+r;if(s[n]){q[n]=s[n];
}else{delete q[n];delete q["_s"+n];}}}try{$.uriAnchor.setAnchor(q);}catch(p){$.uriAnchor.setAnchor(g.anchor_map,null,true);o=false;}return o;};f=function(r){var t,u,q,p,s=true,n=c();
try{p=$.uriAnchor.makeAnchorMap();}catch(o){$.uriAnchor.setAnchor(n,null,true);return false;}g.anchor_map=p;t=n._s_chat;u=p._s_chat;if(!n||t!==u){q=p.chat;
switch(q){case"opened":s=spa.chat.setSliderPosition("opened");break;case"closed":s=spa.chat.setSliderPosition("closed");break;default:spa.chat.setSliderPosition("closed");
delete p.chat;$.uriAnchor.setAnchor(p,null,true);}}if(!s){if(n){$.uriAnchor.setAnchor(n,null,true);g.anchor_map=n;}else{delete p.chat;$.uriAnchor.setAnchor(p,null,true);
}}return false;};a=function(){if(g.resize_idto){return true;}spa.chat.handleResize();g.resize_idto=setTimeout(function(){g.resize_idto=undefined;},m.resize_interval);
return true;};j=function(p){var o,q,n=spa.model.people.get_user();if(n.get_is_anon()){q=prompt("Please sign-in");spa.model.people.login(q);i.$acct.text("... processing ...");
}else{spa.model.people.logout();}return false;};d=function(n,o){i.$acct.text(o.name);};k=function(o,n){i.$acct.text("Please sign-in");};e=function(n){return l({chat:n});
};b=function(n){g.$container=n;n.html(m.main_html);h();$.uriAnchor.configModule({schema_map:m.anchor_schema_map});spa.chat.configModule({set_chat_anchor:e,chat_model:spa.model.chat,people_model:spa.model.people});
spa.chat.initModule(i.$container);spa.avtr.configModule({chat_model:spa.model.chat,people_model:spa.model.people});spa.avtr.initModule(i.$nav);$(window).bind("resize",a).bind("hashchange",f).trigger("hashchange");
$.gevent.subscribe(n,"spa-login",d);$.gevent.subscribe(n,"spa-logout",k);i.$acct.text("Please sign-in").bind("utap",j);};return{initModule:b};}());